"use strict";(self["webpackChunkdemo_toutiao"]=self["webpackChunkdemo_toutiao"]||[]).push([[180],{7393:function(t,e,a){a.d(e,{Z:function(){return d}});var s=function(){var t=this,e=t._self._c;return e("div",[e("van-cell",{on:{click:function(e){return t.toArticleDetail(t.artId)}},scopedSlots:t._u([{key:"title",fn:function(){return[e("div",{staticClass:"title-box"},[e("span",[t._v(t._s(t.article.title))]),1===t.article.cover.type?e("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.article.cover.images[0],expression:"article.cover.images[0]"}],staticClass:"thumb",attrs:{alt:""}}):t._e()]),3===t.article.cover.type?e("div",{staticClass:"thumb-box"},t._l(t.article.cover.images,(function(t,a){return e("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t,expression:"item"}],key:a,staticClass:"thumb",attrs:{alt:""}})})),0):t._e()]},proxy:!0},{key:"label",fn:function(){return[e("div",{staticClass:"label-box"},[e("span",[t._v(t._s(t.article.aut_name)+"   "+t._s(t.article.comm_count)+"评论    "+t._s(t._f("dateFormat")(t.article.pubdate)))]),t.closable?e("van-icon",{attrs:{name:"cross","is-link":"",title:"基础用法"},on:{click:function(e){t.show=!0}}}):t._e()],1)]},proxy:!0}])}),e("van-action-sheet",{attrs:{"cancel-text":"取消",closeable:!1},on:{closed:function(e){t.isFirst=!0}},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[t.isFirst?e("div",t._l(t.actions,(function(a){return e("van-cell",{key:a.name,staticClass:"center-title",attrs:{title:a.name,clickable:"","get-container":"body"},on:{click:function(e){return t.onCellClick(a.name)}}})})),1):e("div",[e("van-cell",{attrs:{title:"返回",clickable:"","title-class":"center-title"},on:{click:function(e){t.isFirst=!0}}}),t._l(t.reports,(function(a){return e("van-cell",{key:a.type,attrs:{title:a.label,clickable:"","title-class":"center-title"},on:{click:function(e){return t.reportArticle(a.type)}}})}))],2)])],1)},n=[],i=a(1596);const l=[{type:0,label:"其它问题"},{type:1,label:"标题夸张"},{type:2,label:"低俗色情"},{type:3,label:"错别字多"},{type:4,label:"旧闻重复"},{type:6,label:"内容不实"},{type:8,label:"侵权"},{type:5,label:"广告软文"},{type:7,label:"涉嫌违法犯罪"}];var r=l,o={name:"ArtItem",data(){return{show:!1,actions:[{name:"不感兴趣"},{name:"反馈垃圾内容"},{name:"拉黑作者"}],isFirst:!0,reports:r}},props:{article:{type:Object,required:!0},closable:{type:Boolean,default:!0}},methods:{async onCellClick(t){if("不感兴趣"===t){const{data:t}=await(0,i.AJ)(this.artId);"OK"===t.message&&this.$emit("remove-article",this.artId),this.show=!1}else"拉黑作者"===t?(console.log("拉黑作者"),this.show=!1):"反馈垃圾内容"===t&&(this.isFirst=!1)},async reportArticle(t){const{data:e}=await(0,i.sk)(this.artId,t);"OK"===e.message&&this.$emit("remove-article",this.artId),this.show=!1},toArticleDetail(t){this.$router.push({name:"article-detail",params:{id:t}})}},computed:{artId(){return this.article.art_id.toString()}}},c=o,h=a(1001),u=(0,h.Z)(c,s,n,!1,null,"449c95ef",null),d=u.exports},8180:function(t,e,a){a.r(e),a.d(e,{default:function(){return b}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home-container"},[e("van-nav-bar",{attrs:{fixed:""},scopedSlots:t._u([{key:"left",fn:function(){return[e("img",{staticClass:"logo",attrs:{src:a(6949),alt:"logo"}})]},proxy:!0},{key:"right",fn:function(){return[e("van-icon",{attrs:{name:"search",size:"18",color:"white"},on:{click:function(e){return t.$router.push("/search")}}})]},proxy:!0}])}),e("van-tabs",{attrs:{sticky:"","offset-top":"1.22666667rem","before-change":t.beforeTabsChange},on:{change:t.onTabsChange},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},t._l(t.userChannel,(function(t){return e("van-tab",{key:t.id,attrs:{title:t.name}},[e("art-list",{attrs:{channelId:t.id}})],1)})),1),e("van-icon",{staticClass:"plus",attrs:{name:"plus",size:"16"},on:{click:t.showPopup}}),e("van-popup",{attrs:{"close-on-click-overlay":!1},on:{closed:function(e){t.isDel=!1}},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[e("div",{staticClass:"popup-container"},[e("van-nav-bar",{attrs:{title:"频道管理"},scopedSlots:t._u([{key:"right",fn:function(){return[e("van-icon",{attrs:{name:"cross",size:"14",color:"white"},on:{click:function(e){t.show=!1}}})]},proxy:!0}])}),e("div",{staticClass:"pop-body"},[e("div",{staticClass:"my-channel-box"},[e("div",{staticClass:"channel-title"},[e("div",[e("span",{staticClass:"title-bold"},[t._v("已添加频道：")]),e("span",{staticClass:"title-gray"},[t._v(t._s(t.isDel?"点击移除频道":"点击进入频道"))])]),e("span",{staticClass:"btn-edit",on:{click:function(e){t.isDel=!t.isDel}}},[t._v(t._s(t.isDel?"完成":"编辑"))])]),e("van-row",{attrs:{type:"flex"}},t._l(t.userChannel,(function(a,s){return e("van-col",{key:a.id,attrs:{span:"6"}},[e("div",{staticClass:"channel-item van-hairline--surround",on:{click:function(e){return t.onUserChannelClick(a,s)}}},[t._v(" "+t._s(a.name)+" "),t.isDel&&"推荐"!==a.name&&t.userChannel.length>2?e("van-badge",{staticClass:"cross-badge",attrs:{color:"transparent"},scopedSlots:t._u([{key:"content",fn:function(){return[e("van-icon",{staticClass:"badge-icon",attrs:{name:"cross",color:"#cfcfcf",size:"12"}})]},proxy:!0}],null,!0)}):t._e()],1)])})),1)],1),e("div",{staticClass:"van-hairline--top sp-line"}),e("div",{staticClass:"more-channel-box"},[e("div",{staticClass:"channel-title"},[e("div",[e("span",{staticClass:"title-bold"},[t._v("可添加频道：")]),e("span",{staticClass:"title-gray"},[t._v("点击添加频道")])])]),e("van-row",{attrs:{type:"flex"}},t._l(t.moreChannels,(function(a){return e("van-col",{key:a.id,attrs:{span:"6"}},[e("div",{staticClass:"channel-item van-hairline--surround",on:{click:function(e){return t.addChannel(a)}}},[t._v(" "+t._s(a.name)+" ")])])})),1)],1)])],1)])],1)},n=[],i=function(){var t=this,e=t._self._c;return e("div",[e("van-pull-refresh",{attrs:{disabled:t.finished},on:{refresh:t.onRefresh},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了","immediate-check":!1},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.artlist,(function(a){return e("art-item",{key:a.art_id,attrs:{article:a},on:{"remove-article":t.removeArticle}})})),1)],1)],1)},l=[],r=a(7393),o=a(1596),c={name:"ArtList",props:{channelId:{type:Number,required:!0}},data(){return{timestamp:Date.now(),artlist:[],loading:!0,finished:!1,isLoading:!1}},methods:{async initArtList(t){const{data:e}=await(0,o.r4)(this.channelId,this.timestamp);"OK"===e.message&&(this.timestamp=e.data.pre_timestamp,t?(this.artlist=[...e.data.results,...this.artlist],this.isLoading=!1):(this.artlist=[...this.artlist,...e.data.results],this.loading=!1),null===e.data.pre_timestamp&&(this.finished=!0))},onLoad(){this.initArtList()},onRefresh(){this.initArtList(!0)},removeArticle(t){this.artlist=this.artlist.filter((e=>e.art_id.toString()!==t)),this.artlist.length<10&&this.initArtList()}},created(){this.initArtList()},components:{ArtItem:r.Z}},h=c,u=a(1001),d=(0,u.Z)(h,i,l,!1,null,"64f123b0",null),p=d.exports;const m={};var v={name:"Home",data(){return{active:0,userChannel:[],show:!1,allChannel:[],isDel:!1}},methods:{async initUserChannel(){const{data:t}=await(0,o.U5)();"OK"===t.message&&(this.userChannel=t.data.channels)},async initAllChannel(){const{data:t}=await(0,o.QM)();"OK"===t.message&&(this.allChannel=t.data.channels)},async updateChannel(){const t=this.userChannel.filter((t=>"推荐"!==t.name)).map(((t,e)=>({id:t.id,seq:e+1}))),{data:e}=await(0,o.YY)(t);"更新用户频道成功"===e.message&&this.$notify({type:"success",message:"更新成功",duration:1e3})},showPopup(){this.show=!0},addChannel(t){this.userChannel.push(t),this.updateChannel()},onUserChannelClick(t,e){if(this.isDel){if("推荐"===t.name)return;this.userChannel=this.userChannel.filter((e=>e.id!==t.id)),this.updateChannel()}else this.active=e,this.show=!1},beforeTabsChange(){const t=this.userChannel[this.active].name;return m[t]=window.scrollY,!0},onTabsChange(){this.$nextTick((()=>{const t=this.userChannel[this.active].name;window.scrollTo(0,m[t]||0)}))}},created(){this.initUserChannel(),this.initAllChannel()},components:{ArtList:p},computed:{moreChannels(){return this.allChannel.filter((t=>{const e=this.userChannel.findIndex((e=>e.id===t.id));return-1===e}))}},beforeRouteLeave(t,e,a){e.meta.top=window.scrollY,a()}},f=v,C=(0,u.Z)(f,s,n,!1,null,"36de09f6",null),b=C.exports},6949:function(t,e,a){t.exports=a.p+"img/logo.d0d391a4.png"}}]);
//# sourceMappingURL=180.f03c0156.js.map
"use strict";(self["webpackChunkdemo_toutiao"]=self["webpackChunkdemo_toutiao"]||[]).push([[403],{2403:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"user-edit-container"},[t("van-nav-bar",{attrs:{title:"编辑资料","left-arrow":"",fixed:""},on:{"click-left":function(t){return e.$router.back()}}}),t("van-cell-group",{staticClass:"action-card"},[t("van-cell",{attrs:{title:"头像","is-link":"",center:""},scopedSlots:e._u([{key:"default",fn:function(){return[t("van-image",{staticClass:"avatar",attrs:{round:"",src:e.userProfile.photo},on:{click:function(t){return e.$refs.fileRef.click()}}}),t("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"fileRef",attrs:{type:"file",accept:"image/*"},on:{change:e.onFileChange}})]},proxy:!0}])}),t("van-cell",{attrs:{title:"名称","is-link":"",value:e.userProfile.name},on:{click:e.onNameCellClick}}),t("van-cell",{attrs:{title:"生日","is-link":"",value:e.userProfile.birthday},on:{click:e.onBirthCellClick}})],1),t("van-dialog",{attrs:{title:"修改名称","show-cancel-button":"","before-close":e.beforeClose},model:{value:e.showNameDialog,callback:function(t){e.showNameDialog=t},expression:"showNameDialog"}},[t("van-field",{ref:"nameRef",attrs:{placeholder:"请输入用户名",center:"","input-align":"center",maxlength:"7"},model:{value:e.name,callback:function(t){e.name="string"===typeof t?t.trim():t},expression:"name"}})],1),t("van-action-sheet",{model:{value:e.showBirthSheet,callback:function(t){e.showBirthSheet=t},expression:"showBirthSheet"}},[t("van-datetime-picker",{attrs:{type:"date",title:"选择出生日期","min-date":e.minDate,"max-date":e.maxDate},on:{cancel:function(t){e.showBirthSheet=!1},confirm:e.updateBirthday},model:{value:e.currentDate,callback:function(t){e.currentDate=t},expression:"currentDate"}})],1)],1)},n=[],s=a(9212),r=a.n(s),o=a(1596),l=a(6294),c={name:"UserEdit",data(){return{showNameDialog:!1,name:"",showBirthSheet:!1,minDate:new Date(1900,0,1),maxDate:new Date(2050,11,31),currentDate:new Date}},methods:{...(0,l.mapActions)(["initUserProfile"]),onNameCellClick(){this.name=this.userProfile.name,this.showNameDialog=!0,this.$nextTick((()=>{this.$refs.nameRef.focus()}))},beforeClose(e,t){return"cancel"===e?t():""===this.name||this.name.length>7?(this.$notify({type:"warning",message:"名称的长度为1-7个字符",duration:2e3}),this.$refs.nameRef.focus(),t(!1)):void this.updateName(t)},async updateName(e){try{const{data:t}=await(0,o.r0)({name:this.name});"OK"===t.message&&(e(),this.initUserProfile(),this.$notify({type:"success",message:"名称更新成功！",duration:2e3}))}catch(t){409===t.response.status?(this.$notify({type:"warning",message:"名称被占用，请更换后重试！",duration:2e3}),e(!1),this.$refs.nameRef.focus()):(e(),this.$notify({type:"danger",message:"名称更新失败！",duration:2e3}))}},onBirthCellClick(){this.currentDate=this.userProfile.birthday?new Date(this.userProfile.birthday):new Date,this.showBirthSheet=!0},async updateBirthday(e){this.showBirthSheet=!1;const t=r()(e).format("YYYY-MM-DD"),{data:a}=await(0,o.r0)({birthday:t});"OK"===a.message&&(this.initUserProfile(),this.$notify({type:"success",message:"生日修改成功!",duration:2e3}))},async onFileChange(e){const t=e.currentTarget.files;if(0===t.length)return;const a=new FormData;a.append("photo",t[0]);const{data:i}=await(0,o.fo)(a);"OK"===i.message&&(this.initUserProfile(),this.$notify({type:"success",message:"更新头像成功！",duration:2e3}))}},computed:{...(0,l.mapState)(["userProfile"])},created(){this.initUserProfile()}},h=c,u=a(1001),f=(0,u.Z)(h,i,n,!1,null,"fee144d4",null),m=f.exports}}]);
//# sourceMappingURL=403.d1b61bf6.js.map